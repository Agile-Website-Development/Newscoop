<!DOCTYPE HTML>
<html>
<head>
<title>Newscoop CMS conversion</title>
<link type="text/css" rel="stylesheet" href="css/import.css" media="all">
<!-- Grab Google CDNs jQuery. fall back to local if necessary -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script>
    !window.jQuery && document.write(unescape('%3Cscript src="/js/jquery-1.4.4.min.js"%3E%3C/script%3E'))
</script>
<script type="text/javascript">
window.validateForm = function() {
    var error_msgs = [];
    var error_msgs_part = document.getElementById ? document.getElementById('error_msgs_part') : null;
    if (error_msgs_part) {
        error_msgs_part.innerHTML = "";
    }

    $("#error_msgs_part").addClass("error_msgs_none");

    var input_user_email = document.getElementById ? document.getElementById('input_user_email') : null;
    var input_user_email_retype = document.getElementById ? document.getElementById('input_user_email_retype') : null;
    var import_file_name = document.getElementById ? document.getElementById('import_file_name') : null;
    var policy_agree_check = document.getElementById ? document.getElementById('input_privacy_policy_agreement') : null;

    var input_user_email_value = '';
    var input_user_email_retype_value = '';
    if (input_user_email && input_user_email.value) {
        input_user_email_value = input_user_email.value;
    }
    input_user_email_value = input_user_email_value.replace(/^\s+/g, "").replace(/\s+$/g, "");
    if (input_user_email_retype && input_user_email_retype.value) {
        input_user_email_retype_value = input_user_email_retype.value;
    }
    input_user_email_retype_value = input_user_email_retype_value.replace(/^\s+/g, "").replace(/\s+$/g, "");

    var email_pattern = /^([^\s]+)@([^\s]+)$/i;

    var policy_agree = false;
    if (policy_agree_check && policy_agree_check.checked) {
        policy_agree = true;
    }

    $("#input_user_email").removeClass("form_fill_incorrect");
    $("#input_user_email_retype").removeClass("form_fill_incorrect");
    $("#import_file_name").removeClass("form_fill_incorrect");
    $("#policy_agreement_fill").removeClass("form_fill_incorrect");

    var is_correct = true;

    if (!email_pattern.exec(input_user_email_value)) {
        is_correct = false;
        $("#input_user_email").addClass("form_fill_incorrect");
        error_msgs.push("fill in email address");
    }

    if (!email_pattern.exec(input_user_email_retype_value)) {
        is_correct = false;
        $("#input_user_email_retype").addClass("form_fill_incorrect");
        error_msgs.push("retype email address");
    }

    if (is_correct) {
        if (input_user_email_value != input_user_email_retype_value) {
            is_correct = false;
            $("#input_user_email").addClass("form_fill_incorrect");
            $("#input_user_email_retype").addClass("form_fill_incorrect");
            error_msgs.push("email addresses differ");
        }
    }

    if('' == import_file_name.value) {
        is_correct = false;
        $("#import_file_name").addClass("form_fill_incorrect");
        error_msgs.push("choose file to convert");
    }

    if (!policy_agree) {
        is_correct = false;
        $("#policy_agreement_fill").addClass("form_fill_incorrect");
        error_msgs.push("you have to agree to the <a href='http://www.sourcefabric.org/en/about/policy/' target='_blank'>policy privacy</a> to use our services");
    }

    var error_text = "";
    var error_msgs_count = error_msgs.length;
    if (error_msgs_part && (0 < error_msgs_count)) {
        error_text += "<strong>Please, fill in missing information:</strong><ul class='error_msgs_list'>";
        for (var eind = 0; eind < error_msgs_count; eind++) {
            error_text += "<li><span class='error_msgs_some'>" + error_msgs[eind] + "</span></li>";
        }
        error_text += "</ul>";
        error_msgs_part.innerHTML = error_text;
        $("#error_msgs_part").removeClass("error_msgs_none");
    }

    return is_correct;
}
</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<h2 class="submit_form_info"><!--Import into Newscoop NewsML-->Newscoop Data Conversion Tool<br>
<span>Import into Newscoop NewsML</span>
</h2>
<div class="submit_form_page">
  <div id="error_msgs_part" class="error_msgs_part error_msgs_none">
  </div>
  <div class="newsml_import_form">
    <form enctype="multipart/form-data" action="%%upload_url%%" method="post" id="file_submit_form" onSubmit="return validateForm();" >
      <input type="hidden" name="MAX_FILE_SIZE" value="30000000">
      <fieldset class="email_fieldset">
      <h3><span>1</span>Provide your data</h3>
      <p class="description">Input your e-mail address, you will get a message with the link to download the NewsML file.</p>
        <dl class="newsml_import_form_field newsml_import_form_email">
          <dt>
            <label for="input_user_email" class="input_user_email_label">Email contact</label>
          </dt>
          <dd>
            <input type="text" id="input_user_email" class="input_user_email" name="useremail" value="fill in your email address" size="40" onfocus="if ('fill in your email address' == this.value) {this.value='';};" onblur="if ('' == this.value) {this.value='fill in your email address'; opacity='0.5';};" title="Download information will be sent to this email address.">
          </dd>
          <dt>
            <label for="input_user_email_retype" class="input_user_email_label">Retype please</label>
          </dt>
          <dd>
            <input type="text" id="input_user_email_retype" class="input_user_email" name="useremail_retype" value="fill in your email address" size="40" onfocus="if ('fill in your email address' == this.value) {this.value='';};" onblur="if ('' == this.value) {this.value='fill in your email address';};" title="Download information will be sent to this email address.">
          </dd>
          <dt>
            <label for="input_privacy_policy_agreement" class="input_privacy_policy_agreement_label">Privacy policy</label>
          </dt>
          <dd id="policy_agreement_fill">
            <input type="checkbox" id="input_privacy_policy_agreement" class="input_privacy_policy_agreement" name="policy_agreement" /><label for="input_privacy_policy_agreement"><span class="input_privacy_policy_agreement_text">I agree to the <a href="http://www.sourcefabric.org/en/about/policy/" target="_blank">Privacy Policy</a>.</span></label>
          </dd>
        </dl>
      </fieldset>
      <fieldset class="file_fieldset newsml_import_form_field newsml_import_form_file">
      <h3><span>2</span>Select the file you want to convert</h3>
      <p class="description">Upload your data file. Currently we only support data importing for Wordpress WXR files. More data sources coming soon.</p>
        <dl class="newsml_import_form_field">
        <input type="hidden" name="cmsformat" value="wxr" />
<!--
          <dt class="cmsformat_part">
            <label for="cmsformat" class="source_cmsformat_label">Source CMS type</label>
          </dt>
          <dd>
            <select id="cmsformat" name="cmsformat">
              <option value="wxr">WordPress WXR
            </select>
          </dd>
-->
          <dt>
            <label>Select the file to convert</label>
          </dt>
          <dd class="newsml_import_form_field">
            <input type="file" name="cmsfile" id="import_file_name">
          </dd>
        </dl>
      </fieldset>
      <div class="newsml_import_form_field recaptcha_part"> 
%%recaptcha_part%%
      </div>
      <div class="newsml_import_form_field newsml_import_form_submit">
        <input class="file_submit" type="submit" value="Send File">
      </div>
    </form>
  </div>
    <p class="wxr_problems"> Note that sometimes WordPress creates invalid dumps (on cdata parts).<br>
      If converting a wxr file fails, you can try an auxiliary <a href="wxrfixer.py">script</a> to fix that.
    </p>
</div>
<div class="footer">
    <p>Â© 2011 <a href="http://www.sourcefabric.org/">Sourcefabric o.p.s.</a> Distributed under GNU GPL v.3 </p>
</div>
</body>
</html>
